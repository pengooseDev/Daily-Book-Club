# Shader그래프공부

## 목적 
게임만들때 매번느끼는 거지만 연출이 참 중요하다.  
연출을 만들때 특유의 감각이라는 부분도 필요하긴하지만.  
적어도 그것을 구현하기위한 기술이 필요하므로 공부해야됨.  
#### 게임을 맛깔나게 만들기 위한 공부. 이것이 목적

## 요구사항 & 조사
그래픽스 파이프라인(Dx,Opencv)을 공부하는것보다 이 쉐이더그래프를  
우선적으로 생각하는 이유는 이건 상품으로서 최전방에 있는 시각적요소이기때문이다.  
(그래도 기본적인 작동원리는 알고 있어야됨)

디자인. 그러니까 첫인상은 정말 중요하다.  
기술도 중요하지만. 손님들한테 판매하기위해서는 어그로가 더 필요하다.  
그 어그로는 시각적요소, 행위, 소리 등이 있고 그것들은 추상적인 개체들이 아니기떄문이다  

사람은 추상적인걸 제대로 못느낀다. 제대로 못느끼니 명백하게 정의를 못하기때문.  
나 자신도 그걸 많이 느끼고 인지하고 있다.  

추상적인걸 위해서 특히 내가 게임에서 경험했던 부분들과 원하는 그림체를 만들때
시행착오가 많이 있었고 결국은 참고자료라는게 모여모여 하나의 구성체가 형성이 되고
그 구성체가 새로운 개념과 개성이 되는 희안한 개체였다.  
(참고자료를 잘모으고 그룹화시키자. 추상적인 목표를 현실로 가져오는 노력이 디자인이다)  

예를 들어 작가님의 그림에 들어가는 기술은 거의 같고 비슷하지만 `해석`을 어덯게 하느냐
에 따라 여러 매력적인 그림체가 나온다.  
이러한 매력적인 그림체는 그 사람의 삶을 보여주는 결과물이라 생각한다.  
삶이라고 하면 단순히 인생이라고 말할수 있지만.  
개인적으로 중요하게 보는건 메인이 되는 미래방향과 생각을 하는 행동방식이라고 생각한다.
추가적으로 자기자신이 매력적인 그림체를 보고 새로운 즐거움이라는 감정을 느낄수 있게 하는게
제일 중요하다고 생각한다.


※프로그래머인데 코드로 안짜고 그래프로 짜겠느냐 라고 생각한 이유는

1. URP와 HDRP사이에 있는 구역을 유니티에서 자체적으로 제어해주는 구역이 있는데 그러한
구역을 직접적으로 처리하는 시간을 생각했을때 오히려 이게맞다고 생각된다. 작업시간이 길어진다  
2. 쉐이더그래프로 직관적으로 볼수 있다.  
3. 지금 짜고 있는 C#코드만 5만줄이 넘어가는데 거기에 추가적으로 저런것도 관리하라구? 흠  



다시 돌아와서 이건 실질적으로 보여주고 맛깔스럽게 만들수 있으니까.  
이게 목표다. 단순한게 최고다.

(스킬시스템에서 인디케이터 만들때등 시각적으로 매력적인게 안보여서 작업할때 맘에 안드는.)

생각보다 자료는 많다.  

쉐이더그래프 요소관련과 기초지식들
고라니
https://youtu.be/KnueAgpUL3Y
1: 21 : 10


자주사용하거나 필요한 현상?이팩트느낌
바닥갈라지기
투사체
폭발
신기루등



비쥬얼이팩트그래프
https://unity.com/visual-effect-graph


---









Shader를 다루기

특정정점의 90도 구현
벡터는 0~1까지만 표현
DXT는 알파랑 따로
ASTC는 RGBA다 저장
노말맵은 픽셀단위로 달라짐
공간은 행럴로 표현
A B를 내적
유니티는 열기준행럴로 곱함
노멀/범프/하이트/디스
XYZW
XYZ 회전
A 이동 
유니티는 왼손 좌표계
두개의 벡터를 외적으로하면
나머지한개로 외적이 나옴
공간좌표축이 나올때 공간이 만들때 외적을 이용
탄젠트 좌표계
Binormal, BiTangent
BI => Binary
노말은 회전만 있으니까 
3X3으로 충분
MainLightDirection
Negate => 뒤집힘
TransForm노드에서 처리하게 할수 있음
WS=>월드스페이스
VS=>뷰스페이스
노멀이등 범프맵이든 기술은 똑같음
범프맵은 노멀맵으로 생각해도 됨
Cross => 외적
Dot=> 내적
S는 Space로 보면 된다 네이밍이 거의그럼
행렬을 가르키는 TS OS WS 
이득우
3D
깨공수학
수포자수학
노말맵에 대한 기초이론




고라니 영상
1: 21 10 부터인데
이거 다시봐야되나 아니면 다른거먼저 보고 체크한다음 넘어갈까



## 단어집
transparent = 투명
opaque = 불투명






20230330
대마왕의 유니티 URP 셰이더 그래프
책보고 공부한거

셰이더 그래프는 사실상 HLSL 셰이더를 노드형태의 껍데기로 감싸 놓은것뿐,
그래서 셰이더그래프로 제작된것은 HLSL 셰이더로 다시 변환되어 적용되며, 
각 노드는 함수로 관리됨.

HLSL == High Level Shader Language 의 약자로 DirectX에서 사용가능한 셰이더 언어


## 셰이더를 익히기 위한 기반지식들
### 1. 랜더링 파이프라인(랜더링의 순서)

1. 오브젝트 데이터 받아오기  
2. 정점(버텍스 : Vertex) 셰이더  
유니티에서는 이 로컬좌표계를 오브젝트 좌표계로 부름


3. 레스터라이져(Rasterizer)

이러한 모든작업들이 매프레임마다 일어나고  
화면에는 버텍스보다 픽셀이 더많으니  
픽셸세이더가 버텍스 세이더보다 더 무거움  

4. 픽셀세이더(pixel shader) / 프레그먼트 세이더(Fragment shader)


프레그먼트(조각) 세이더는 픽셀보다도 더 상위의 개념을 말하는 용어



### 2. 모니터에 표현되는 색과 빛의 기본원리(모니터의 색은 어덯게 표현되는가)

모니터에서 표현되는 색은 가산혼합으로 만들어집니다.
가산혼합이란 RGB로 이루어진 색을 더하면 더할수록 밝아지며, 모두더하면 흰색이  
되는 색체계를 의미함.






61p 실습과제  
1. 보라색  
R : 0.5  
G : 0  
B : 1  

2. 하늘색  
R : 0  
G : 0.5  
B : 1  




컬러연산

더하기빼기 관련  (Linear Dodge(Add))
1. 밝기 증가로 생각하기  
2. 1 초과의 수로 생성되도 1임. 1초과를 표현 못함  
3. 빼기도 마찬가지 0미만으로 표현 못함  

곱하기나누기 관련 (Muliply)
1. 어두워짐
2. 나누기는 상대적으로 계산도 느리고 곱셈연산으로 대처가 가능하기떄문에 구지안씀

컬러의 반전
1. 1에서 어떤색을 빼면 그색이 반전됩니다.
2. 1 - float3(1,0,0) 은 float3(1,1,1) - float3(1,0,0) 과 동일한 결과가 나옴

69p 실습과제
회색은 반전해도 똑같이 0.5 0.5 0.5가 나오기때문



## 세이더 그래프의 경로 바꾸기  
세이더의 이름을 바꾸려먼 세이더의 파일명을 바꿔야하고  
세이더의 폴더를 바꿀려면 세이더그래프에서 폴더명과 경로를 적어줘야된다.  
BlackBoard창에서 파일이름 아래 다른이름이 존재하는데 거기가 경로이다.   
이런 경로를 사용하여 세이더들을 분류할수 있다.  


## 주의사항
세이더그래프는 ctrl + s를 단축키가 작동되지않음  




## Property 공통파라미터

Name : Property의 이름  
Reference : 입력 받은 값의 "변수값".(왠만해선 Name하고 Reference를 통일해주기)
Default : 셰이더가 처음생성될때 가지게 될 "초기값"
Precision : "정확도" 정도로 생각하면 됩니다. 플랫폼에 따라 셰이더에서 사용되는 숫자를 정밀도를 조절하는것인데,
대부분의 경우 크게 신경 쓸필요는 없습니다.  
(경험에 따르면 셰이더의 정밀도를 줄여서 메모리나 속도를 조금 절약하느니 텍스쳐한장을 줄이는게 더 효과가 좋습니다.)  
-1. inherit : 뒤에 따라오는 노드의정밀도에 따라 변함
-2. single : float 정밀도(32bit)를 사용
-3. half : half(16bit)를 사용
-4. usegraphprecision : 그래프 전체에서 사용하는 정밀도를 따릅니다.

Exposed : 인스팩터에 노출되는 여부
Override Property Declaration : 프로퍼티속성을 재선언
global : 셰이더를 글로벌에서 제어
per Material : 셰이더를 메터리얼별로 제어
Hybrid Per Instance : DOTS를 사용할때 하이브리드 랜더라와 함계 셰이더를 사용하는 옵션


프로퍼티 => 변수
float mode에 Slider있음



### Color Property
mode에 HDR선택이 있음

LDR(Low Dynamic range)

HDR(High Dynamic range) => 1이상의 밝기를 만들때


### category
변수가 너무 많으면 예쁘게 묶어주는 역할




### shaderGraph 

masterStack : 실제로 셰이더에 값을 넣게 되는 최종결과 노드

position : 위치
normal : 노말
tangent : 접선

# Split와 Combine
셰이더에서 노드의값은 자유자재로 섞거나 분해하거나 바꿔치기가 가능.  
이부분을 자유자재로 해내는것이 셰이더의 기본이라고 해도 과언이 아닐정도로 중요.  

### 1. 노드요소의 자리바꾸기
Split => 요소분해
Combine => 요소합침





20230502
### Split

※float3으로 들어온 값이 float3으로 출력하는게 가장 좋은 모양이다.  
실제로 혹시 모르는 오류를 방지하기에도 좋은 습관이다.

float3을 Split 하면 r g b a 로 나누어지고 해당 나누어진걸
형식만 맞으면 연결할수 있는곳에 다 연결할수 있다.

이렇게 쉽게 자리를 바꿀수 있는것이라는 명칭을 스위즐링(Swizzling)이라고 하고,  
셰이더에서 매우 유용하게 사용하는 기술이다.

매우 유용해서 자주쓰이는 행동은 전용노드가 만들어져 있는 경우가 있다.
스위즐링 또한 너무 자주쓰이기때문에 Swizzle이라고 하는 노드가 만들어져 있다.

사용법은 Swizzle노드에 연결후 xz xxx 등으로 쓰면 그거되로 출력됨.

##### ※이 기능은 편리하지만 개인적으로는 직관성이 좀 떨어지는것 같아서 즐겨 사용하지는 않습니다.
##### 여러 기술을 사용하는것보다 나중에 누가 보더라도 알아보기 쉽게 짜는것이 최고의 방법입니다.

### Combine

128p
※이것은 매우 중요하므로 꼭 해보시기 바랍니다. 이것이 익숙해지지 않으면 셰이더를 공부하기 힘듭니다.

셰이더그래프와 같은 비쥬얼 셰이더 에디터의 가장 큰 단점은 조금만 커지면 알아보기가 쉽지 않다는것
그것을 해결하기 위해 접기기능이 있다.(선택한 모든노드들을 클릭하고 접으면 다접힘!! 끼얏호우)

중간연결 노드 : 선을 더블클릭하면 생긴다. 선을 정리하기 위해 사용함
이를 이용해서 보기 좋게 정리해봅시다. 휠씬 보기 좋고 깔끔해졋습니다. 마음이 평온하고 잠이 잘올것 같습니다.

그룹 만들기 : 칸트롤 + G, 칸트롤 U(해제)

스티키(Sticky) 노트
여기저기 도움말을 붙어 놓을수 있어서 용이


※어떤노드인지는 스스로 도움말(Open Documentation)을 이용해서 알아보기
책에서 모든 노드를 설명할수 없으니 스스로 노드를 찾아보면서 공부하는 습관을 갖기 바랍니다


# 노드(숫자)의 연산
숫자는 컬러와 같다고 생각해야 한다고 했지요.

※ 실제 세이더에서 사용하는 색의개념은 알파채널을 포함한 vector4를 많이 사용합니다
Add : Up 시킬때. 포토샵의 Add
Multiply : 곱하기! 포토샵의 Multi
Sub : 빼기!
Divide : 나누기!

### 노드의 반전
1 - x == 반전
반전 기능이 많이 사용되서 OneMinus 라는 전담노드가 만들어져있다.
여기에 연결하면 1에서 연결한 노드를 뺸 결과가 출력됨.


### 0 ~ 1 사이를 넘어가는 연산

값이 남아있지만 모니터에서 표현을 못해줘서 0~1사이로 표현됨
하지만 HDR로 작업하고 1이상 색을 받으면 Bloom효과가 날수 있도록 되어있다면 주변으로 빛남

### 각종 블렌딩연산
셰이더그래프에서 블렌딩연산 공식을 미리 준비해놓음
Blend Node를 사용(몇몇연산은 약간 무겁다)

### Color의 연산과 감마 코렉션
##### 숫자와 컬러는 같다

컬러(SRGB) 회색을 더하는거랑 숫자(Linear) 회색을 더하는건 다르게 나온다.
사람의 색 감각에 맞추기 위한 색상보정인 '감마코렉션(Gamma Correction)'이라고 한다

컬러를 제대로 연산할려면 ColorSpaceConversion노드를 사용한다.  
컬러공간변환.  

### ♡컬러는 무조건 Colorspace Conversion으로 Linear > RGB로 해주는 게 옳은 계산이야! 라고 외우셔도 좋다.

컬러 == 컬러노드 == Gamma가 감마  

※조심해야 할게 있습니다. 옳은것과 좋은것은 다른것입니다. 수학적으로야 컬러공간을 변환해주는게 옳다지만,  
셰이더는 결과를 예쁘게 만들기 위해 계산하는 툴일 뿐입니다.  
아티스트가 생각하기에 예쁜결과가 나왔다면, 좀 옳지않아도 어덯습니까?  
어차피 지금도 사용하고 있는 셰이더의 많은 공식들도 '그럴 듯'하게 보이도록 만든 공식이 대부분입니다!  
사람은 마음이 중요하다고 하지만 셰이더는 예쁘고 가벼우면 다 용서됩니다.  
하지만, '옳지 않지만 이게 더 예쁘니까'를 선택하는것과 '옳은것인지 틀린것인지를 모르는것은' 차이가 있습니다.


# 색상과 텍스쳐의 연산, Lerp

Lerp는 Linear Interpolation을 의미하는말로 선형보간이라고 부르며,
매우 흔하게 사용되는 셰이더노드이다.

`그저 직선적인 비율로 값이 변환되는것을 의미`할뿐입니다.
흔히 볼수 있는 대표적인 선형보간의 예는 그라데이션 이미지이다.

Lerp는 두이미지를 자연스럽게 전환하는데 유리하는것을 알수 있다.

# Lerp노드를 응용해봅시다
검은게 0, 흰색이 1
여기선 알파 값을 사용하여 Lerp를 이용함
책에서 처럼 알파값을 사용하면 검은색만 떠서 왜그런지 알아봐야됨

![아무런변화없는 Lerp](아무런변화없는Lerp.png)

따로해결
![Lerp이미지](Lerp이미지.png)


1. Lerp의 순서를 바꾼다
2. OneMinus해서 역으로 곱한다



## 실습과제 텍스쳐한장만 받아서 컬러에서 흑백으로 변하는 기능을 만드는거
![컬러를흑백으로](컬러를흑백으로.png)



# UV의 기본개념







